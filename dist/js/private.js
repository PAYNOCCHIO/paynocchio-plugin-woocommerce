(()=>{"use strict";class e{constructor(e){this.options=Object.assign({element:null,effect:"zoom",state:"closed",size:"medium",content:null,footer:null,header:null,title:null},e),null==this.options.element&&(this.options.element=document.createElement("div"),this.options.element.classList.add("modal"),this.options.element.innerHTML='\n                <div class="container">\n                    <div class="header">\n                        <button class="close">&times;</button> \n                    </div>\n                    <div class="content"></div>\n                    <div class="footer">\n                        <button class="close">Close</button>\n                    </div>\n                </div>                        \n            ',document.body.appendChild(this.options.element)),this.options.element.querySelector(".container").classList.remove("zoom","slide"),this.options.element.querySelector(".container").classList.add(this.options.effect),null!=this.options.header&&(this.header=this.options.header),null!=this.options.content&&(this.content=this.options.content),null!=this.options.footer&&(this.footer=this.options.footer),null!=this.options.title&&(this.title=this.options.title),this.size=this.options.size,this._eventHandlers()}open(){this.options.state="open",this.options.element.style.display="flex",this.options.element.getBoundingClientRect(),this.options.element.classList.add("open"),document.body.classList.add("paynocchio-modal-open"),this.options.element.parentNode!==document.body&&document.body.append(this.options.element),this.options.onOpen&&this.options.onOpen(this)}close(){1==document.querySelectorAll(".modal.open").length&&document.body.classList.remove("paynocchio-modal-open"),this.options.state="closed",this.options.element.classList.remove("open"),this.options.element.style.display="none",this.options.onClose&&this.options.onClose(this)}get state(){return this.options.state}get effect(){return this.options.effect}set effect(e){this.options.effect=e,this.options.element.querySelector(".container").classList.remove("zoom","slide"),this.options.element.querySelector(".container").classList.add(e)}get size(){return this.options.size}set size(e){this.options.size=e,this.options.element.classList.remove("small","large","medium","full"),this.options.element.classList.add(e)}get content(){return this.options.element.querySelector(".content").innerHTML}get contentElement(){return this.options.element.querySelector(".content")}set content(e){e?(this.options.element.querySelector(".content")||this.options.element.querySelector(".container").insertAdjacentHTML("afterbegin",'<div class="content"></div>'),this.options.element.querySelector(".content").innerHTML=e):this.options.element.querySelector(".content").remove()}get header(){return this.options.element.querySelector(".header").innerHTML}get headerElement(){return this.options.element.querySelector(".header")}set header(e){e?(this.options.element.querySelector(".header")||this.options.element.querySelector(".container").insertAdjacentHTML("afterbegin",'<div class="header"></div>'),this.options.element.querySelector(".header").innerHTML=e):this.options.element.querySelector(".header").remove()}get title(){return this.options.element.querySelector(".header .title")?this.options.element.querySelector(".header .title").innerHTML:null}set title(e){this.options.element.querySelector(".header .title")||this.options.element.querySelector(".header").insertAdjacentHTML("afterbegin",'<h3 class="title"></h3>'),this.options.element.querySelector(".header .title").innerHTML=e}get footer(){return this.options.element.querySelector(".footer").innerHTML}get footerElement(){return this.options.element.querySelector(".footer")}set footer(e){e?(this.options.element.querySelector(".footer")||this.options.element.querySelector(".container").insertAdjacentHTML("beforeend",'<div class="footer"></div>'),this.options.element.querySelector(".footer").innerHTML=e):this.options.element.querySelector(".footer").remove()}_eventHandlers(){this.options.element.querySelectorAll(".close").forEach((e=>{e.onclick=e=>{e.preventDefault(),this.close()}}))}static initElements(){document.querySelectorAll("[data-modal]").forEach((t=>{t.addEventListener("click",(a=>{a.preventDefault();let o=document.querySelector(t.dataset.modal),n=new e({element:o});for(let e in o.dataset)n[e]&&(n[e]=o.dataset[e]);n.open()}))}))}static confirm(t,a,o){let n=new e({content:t,header:"",footer:'<button class="success">OK</button><button class="cancel alt">Cancel</button>'});n.footerElement.querySelector(".success").onclick=e=>{e.preventDefault(),a&&a(),n.close()},n.footerElement.querySelector(".cancel").onclick=e=>{e.preventDefault(),o&&o(),n.close()},n.open()}static alert(t,a){let o=new e({content:t,header:"",footer:'<button class="success">OK</button>'});o.footerElement.querySelector(".success").onclick=e=>{e.preventDefault(),a&&a(),o.close()},o.open()}static prompt(t,a,o,n){let s=new e({header:"",footer:'<button class="success">OK</button><button class="cancel alt">Cancel</button>'});s.content=t+`<div class="prompt-input"><input type="text" value="${a}" placeholder="Enter your text..."></div>`,s.footerElement.querySelector(".success").onclick=e=>{e.preventDefault(),o&&o(s.contentElement.querySelector(".prompt-input input").value),s.close()},s.footerElement.querySelector(".cancel").onclick=e=>{e.preventDefault(),n&&n(s.contentElement.querySelector(".prompt-input input").value),s.close()},s.open()}}function t(e,t,a,o){const n=document.getElementById("top_up_amount");document.getElementById("topup_message").innerHTML=t>0?'Your balance will be replenished by $<span id="replenishAmount">'+a+'</span>, commission is $<span id="commissionAmount">'+o+'</span>. You will get <span id="bonusesCounter">'+t+"</span> bonuses.":'Your balance will be replenished by $<span id="replenishAmount">'+a+'</span>, commission is $<span id="commissionAmount">'+o+"</span>.",n&&n.setAttribute("data-value",e)}var a;(a=jQuery)(document).ready((function(){a(".top-up-variants > a").click((function(){let e=a(this).get(0).id.replace("variant_","");a("#top_up_amount").val(e),t(e,.1)})),a(".toggle-autodeposit").click((function(){a(this).toggleClass("checked"),a(this).hasClass("checked")?a("input#autodeposit").attr("value","1"):a("input#autodeposit").attr("value","0")})),a(".card-var").click((function(){a(".card-variants").toggleClass("clicked"),a(".clicked .card-var").click((function(){a(".card-var").removeClass("current-card"),a(this).addClass("current-card"),a("#source-card").attr("value",a(this).attr("data-pan"))}))}))})),(a=>{let o,n,s,i,l;a.ajax({async:!1,url:paynocchio_object.ajaxurl,global:!1,type:"GET",data:{action:"paynocchio_ajax_get_env_structure"},success:function(e){i=e.response.wallet_fixed_commission,n=e.response.wallet_percentage_commission/100,s=1-n,l=e.response.structure.bonus_conversion_rate,o=e.response.structure.rewarding_group.rewarding_rules}});const r=(e,t,a)=>{let o,n=0,s=1/0,i=-1/0,l=1;return e&&e.forEach((e=>{e.operation_type===a&&t>=e.min_amount&&t<=e.max_amount&&(n+=e.value,o=e.value_type,l=e.conversion_rate,e.min_amount<s&&(s=e.min_amount),e.max_amount>i&&(i=e.max_amount))})),{totalValue:"percentage"===o?n/l:n,minAmount:s,maxAmount:i,value_type:o,conversion_rate:l}},c=(e=>{const t=[];return e?(e.forEach((e=>{let a=t.find((t=>t.operation_type===e.operation_type&&t.min_amount===e.min_amount&&t.max_amount===e.max_amount));a?a.value+=e.value:t.push({...e})})),t):null})(o),p=(e,t,a)=>{const o=r(t,e,a).totalValue;return"percentage"===r(t,e,a).value_type?Math.floor(e*(o/100)):o},u=(e,t,a,o)=>{if(t&&!0===t&&a)m(e,a,o);else{let t=e*parseFloat(s)-parseFloat(i);t=Math.round(100*t)/100;let a=e*parseFloat(n)+parseFloat(i);a=Math.round(100*a)/100;let o=e-e*parseFloat(n)-parseFloat(i);o=Math.round(100*o)/100}};const d=e=>{a("#top_up_amount").val()?(a(e.target).addClass("cfps-disabled"),a(`#${e.target.id} .cfps-spinner`).removeClass("cfps-hidden"),a.ajax({url:paynocchio_object.ajaxurl,type:"POST",data:{action:"paynocchio_ajax_top_up","ajax-top-up-nonce":a("#ajax-top-up-nonce").val(),amount:a("#top_up_amount").val(),redirect_url:window.location.href},success:function(e){200===e.response.status_code?window.location.replace(JSON.parse(e.response.response).schemas.url):a(".topUpModal .message").html("An error occurred. Please reload page and try again!")}}).error((e=>alert(e.response.response))).always((function(){a(`#${e.target.id} .cfps-spinner`).addClass("cfps-hidden"),a(e.target).removeClass("cfps-disabled")}))):a(".topUpModal .message").html("Please enter amount!")},m=(e,t,o)=>{a.ajax({url:paynocchio_object.ajaxurl,type:"GET",data:{action:"paynocchio_ajax_get_structure_calculation",amount:parseFloat(e),operation_type:t,wallet_balance_check:o},success:function(e){if(e.response.error)"payment_operation_add_money"==t?a("#topup_message").html("An error has occurred"):"payment_operation_withdraw"==t?a("#withdraw_message").html("An error has occurred"):"payment_operation_for_services"==t&&a("#paynocchio_payment_bonuses").html("An error has occurred");else{let o=e.response.operations_data[0].commission_amount,n=e.response.operations_data[0].full_amount,s=e.response.operations_data[0].bonuses_amount;"payment_operation_add_money"==t?(s>0?a("#topup_message").html('Your balance will be replenished by $<span id="replenishAmount">'+n+'</span>, commission is $<span id="commissionAmount">'+o+'</span>. You will get <span id="bonusesCounter">'+s+"</span> bonuses."):a("#topup_message").html('Your balance will be replenished by $<span id="replenishAmount">'+n+'</span>, commission is $<span id="commissionAmount">'+o+"</span>."),a("#topup_message").removeClass("loading")):"payment_operation_withdraw"==t?(a("#withdraw_message").html('You will receive a withdrawal for $<span id="withdrawal_amount">'+n+'</span>, commission is $<span id="withdrawal_commission_amount">'+o+"</span>."),a("#withdraw_message").removeClass("loading")):"payment_operation_for_services"==t&&(a("#paynocchio_payment_bonuses").html("You will get additional "+s+" bonuses for this purchase."),a("#paynocchio_payment_bonuses").removeClass("loading"))}}}).error((e=>console.log(e)))},h=(e,t)=>{a(e.target).addClass("cfps-disabled"),a(".paynocchio-profile-actions .cfps-spinner").removeClass("cfps-hidden"),a.ajax({url:paynocchio_object.ajaxurl,type:"POST",data:{action:"paynocchio_ajax_set_status","ajax-status-nonce":a("#ajax-status-nonce").val(),status:t},success:()=>a(window.location.reload())}).error((e=>alert(e))).always((()=>a(".paynocchio-profile-actions .cfps-spinner").addClass("cfps-hidden")))};function _(){a.ajax({url:paynocchio_object.ajaxurl,type:"POST",data:{action:"paynocchio_ajax_check_balance"},success:function(e){!function(e,t){a(".paynocchio-balance-value").attr("data-balance",e),a(".paynocchio-bonus-value").attr("data-bonus",t);let o=parseFloat(a(".paynocchio-balance-value").first().text()),n=parseFloat(e),s=parseFloat(a(".paynocchio-bonus-value").first().text()),i=parseFloat(t);function l(e,t,o){let n=a(".paynocchio-"+e+"-value");if(t===o)return;let s=t,i=(o-t)/250,l=0;var r=setInterval((function(){s+=i;let e=parseFloat(s).toFixed(2);n.html(e),l++,250==l&&(clearInterval(r),n.html(o.toFixed(2)))}),4)}l("balance",o,n),l("bonus",s,i)}(e.response.balance,e.response.bonuses)}}).error((e=>console.log(e)))}function y(e,t){let a;return function(...o){clearTimeout(a),a=setTimeout((()=>e.apply(this,o)),t)}}const v=y(((e,t,o)=>{parseFloat(e)+t>o?(a("#topup_message").html("When replenishing the amount $"+e+" the balance limit will exceed the set value $"+o),a("#top_up_button").attr("disabled","true").addClass("disabled"),a("#topup_message").removeClass("loading")):e<parseFloat(a("#top_up_amount").attr("min"))?(a("#top_up_button").attr("disabled","true").addClass("disabled"),a("#topup_message").html("Please enter amount more than minimum replenishment amount."),a("#topup_message").removeClass("loading")):(a("#top_up_button").removeAttr("disabled").removeClass("disabled"),u(e,!0,"payment_operation_add_money",!1))}),500),g=y(((e,t,o)=>{parseFloat(e)>t?(a("#withdraw_message").html("Insufficient funds. Please check the wallet balance."),a("#withdraw_button").attr("disabled","true").addClass("disabled"),a("#withdraw_message").removeClass("loading")):e<o?(a("#withdraw_button").attr("disabled","true").addClass("disabled"),a("#withdraw_message").html("Please enter amount more than minimum withdrawal amount."),a("#withdraw_message").removeClass("loading")):(a("#withdraw_button").removeAttr("disabled").removeClass("disabled"),u(e,!0,"payment_operation_withdraw",!1))}),500),f=y(((e,t,o)=>{let n,s,i,l,r=a("#paynocchio_after_discount"),c=a("#paynocchio_discount"),p=a("#paynocchio_payment_bonuses");t*o<e?(n=t,s=t*o):(n=e/o,s=e),i=(n*o*100/e).toFixed(2),l=(e-s).toFixed(2),r.html(l),c.html(i),u(l,!0,"payment_operation_for_services",!1),0!=l?p.show():p.hide(),l==e?(a(".paynocchio_before_discount").hide(),a(".paynocchio_discount").hide()):(a(".paynocchio_before_discount").show(),a(".paynocchio_discount").show())}),500);a(document).ready((function(){e.initElements();const o=a("#top_up_button"),r=a("#withdraw_button"),m=a("#suspend_button"),y=a("#reactivate_button"),b=a("#block_button"),w=a("#delete_button");o.click((e=>d(e))),r.click((e=>(e=>{if(!a("#withdraw_amount").val())return void a(".withdrawModal .message").html("Please enter amount!");a(e.target).addClass("cfps-disabled"),a(`#${e.target.id} .cfps-spinner`).removeClass("cfps-hidden");const t=parseFloat(a("#withdraw_amount").val());parseFloat(a("#witdrawForm .paynocchio-balance-value").text())<t?(a("#withdraw_message").text("Sorry, can't do ;)"),a(e.target).removeClass("cfps-disabled"),a(`#${e.target.id} .cfps-spinner`).addClass("cfps-hidden")):a.ajax({url:paynocchio_object.ajaxurl,type:"POST",data:{action:"paynocchio_ajax_withdraw","ajax-withdraw-nonce":a("#ajax-withdraw-nonce").val(),amount:parseFloat(a("#withdraw_amount").val())},success:function(e){200===e.response.status_code?(a("#withdraw_amount").val(""),a(".withdrawModal .message").text("Success!"),_(),function(){const e=a("#place_order"),t=a(".payment_box.payment_method_paynocchio").is(":hidden");e&&!t&&a(document.body).trigger("update_checkout")}(),a(".withdrawModal").delay(1e3).fadeOut("fast"),a("body").removeClass("paynocchio-modal-open")):a(".withdrawModal .message").text("An error occurred. Please reload page and try again!")}}).error((e=>console.log(e))).always((function(){a(`#${e.target.id} .cfps-spinner`).addClass("cfps-hidden"),a(e.target).removeClass("cfps-disabled")}))})(e))),m.click((e=>h(e,"SUSPEND"))),y.click((e=>h(e,"ACTIVE"))),b.click((e=>h(e,"BLOCKED"))),w.click((e=>(e=>{a(e.target).addClass("cfps-disabled"),a(`#${e.target.id} .cfps-spinner`).removeClass("cfps-hidden"),a.ajax({url:paynocchio_object.ajaxurl,type:"POST",data:{action:"paynocchio_ajax_delete_wallet","ajax-delete-nonce":a("#ajax-delete-nonce").val()},success:e=>a(window.location.reload())}).error((e=>console.log(e)))})(e))),a("form.checkout").on("change",'input[name="payment_method"]',(function(){a(document.body).trigger("update_checkout")})),a("#top_up_amount").on("keyup change",(e=>{let t=parseFloat(a("#card_balance_limit").text()),o=parseFloat(a(".paynocchio-balance-value").first().text()),n=parseFloat(e.target.value);a("#topup_message").addClass("loading"),v(n,o,t)})),a(".top-up-variants > a").click((function(){let e=a(this).get(0).id.replace("variant_","");a("#top_up_amount").val(e),a("#topup_message").addClass("loading"),u(e,!0,"payment_operation_add_money",!1)})),a("#withdraw_amount").on("keyup change",(e=>{let t=parseFloat(a(".paynocchio-balance-value").first().text()),o=parseFloat(e.target.value);a("#withdraw_message").addClass("loading"),g(o,t,1)})),a(document).on("updated_checkout",(function(){e.initElements(),a("#top_up_button").click((e=>d(e))),_(),function(e,t=window.location.href){e=e.replace(/[\[\]]/g,"\\$&");const a=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null}("ans")&&a(".woocommerce-notices-wrapper:first-child").prepend('<div class="woocommerce-message" role="alert">Registration complete. Please check your email, then visit this page again.</div>'),a("#top_up_amount").on("keyup change",(e=>{let t=parseFloat(a("#card_balance_limit").text()),o=parseFloat(a(".paynocchio-balance-value").first().text()),n=parseFloat(e.target.value);a("#topup_message").addClass("loading"),v(n,o,t)})),a(".top-up-variants > a").click((function(){let e=a(this).get(0).id.replace("variant_","");a("#top_up_amount").val(e),a("#topup_message").addClass("loading"),u(e,!0,"payment_operation_add_money",!1)}));const o=a("#bonuses-value"),r=a("#bonuses-input"),m=parseFloat(a(".woocommerce-Price-amount").last().text().replace("$",""));function h(){const e=a("#place_order"),t=a(".payment_box.payment_method_paynocchio").is(":hidden");if(e&&!t){const t=parseFloat(a(".paynocchio-balance-value").first().attr("data-balance")),o=parseFloat(a(".paynocchio-bonus-value").first().attr("data-bonus")),n=parseFloat(a(".woocommerce-Price-amount").last().text().replace("$","")),s=parseFloat(a("#bonuses-value").val());t+o*l<n?(e.addClass("cfps-disabled"),e.text("Please TopUp your Wallet")):t+o*l>=n&&s*l+t<n?(e.addClass("cfps-disabled"),e.text("Please TopUp your Wallet or use your Bonuses")):(e.removeClass("cfps-disabled"),e.text("Place order"))}}console.log(m),o.val(r.val()),a(document).ready((function(){a("#paynocchio_payment_bonuses").addClass("loading"),f(parseFloat(m),r.val(),parseFloat(l))})),r.on("change",(function(){o.val(r.val()),a("#paynocchio_payment_bonuses").addClass("loading"),f(parseFloat(m),r.val(),parseFloat(l)),h()})),o.on("change",(function(){r.val(o.val()),a("#paynocchio_payment_bonuses").addClass("loading"),f(parseFloat(m),r.val(),parseFloat(l)),h()})),a("input[type=range]").on("input",(function(){a(this).trigger("change")})),a(".toggle-autodeposit").click((function(){a(this).toggleClass("checked"),a(this).hasClass("checked")?a("input#autodeposit").attr("value","1"):a("input#autodeposit").attr("value","0")})),a(".card-var").click((function(){a(".card-variants").toggleClass("clicked"),a(".clicked .card-var").click((function(){a(".card-var").removeClass("current-card"),a(this).addClass("current-card"),a("#source-card").attr("value",a(this).attr("data-pan"))}))})),h(),a("#bonuses-value").on("change",(function(){h()})),a('input[type="range"].slider-progress').each((function(){a(this).css("--value",a(this).val()),a(this).css("--min",""==a(this).attr("min")?"0":a(this).attr("min")),a(this).css("--max",""==a(this).attr("max")?"0":a(this).attr("max")),a(this).on("input",(function(){a(this).css("--value",a(this).val()),a("#bonuses-value").trigger("change")}))})),a("#top_up_amount").on("keyup change",(e=>{let o=0,l=parseFloat(e.target.value);p(l,c,"payment_operation_add_money")>0&&(o=p(l,c,"payment_operation_add_money"));let r=((e,t,a,o)=>{{let e=sum*parseFloat(s)-parseFloat(i);return e=Math.round(100*e)/100,e}})(),u=(e=>{let t=e*parseFloat(n)+parseFloat(i);return t=Math.round(100*t)/100,t})(l);t(e.target.value,o,r,u);let d=parseFloat(a("#card_balance_limit").text()),m=parseFloat(a(".paynocchio-balance-value").first().text());parseFloat(e.target.value)+m>d?(a("#topup_message").html("When replenishing the amount $"+l+" the balance limit will exceed the set value $"+d),a("#top_up_button").attr("disabled","true").addClass("disabled")):e.target.value<parseFloat(a("#top_up_amount").attr("min"))?(a("#top_up_button").attr("disabled","true").addClass("disabled"),a("#topup_message").html("Please enter amount more than minimum replenishment amount.")):(a("#top_up_button").removeAttr("disabled").removeClass("disabled"),o>0?a("#topup_message").html('Your balance will be replenished by $<span id="replenishAmount">'+r+'</span>, commission is $<span id="commissionAmount">'+u+'</span>. You will get <span id="bonusesCounter">'+o+"</span> bonuses."):a("#topup_message").html('Your balance will be replenished by $<span id="replenishAmount">'+r+'</span>, commission is $<span id="commissionAmount">'+u+"</span>."))}))})),a("#show_mini_modal").on("click",(function(){a(".topup_mini_form").toggle(),a(this).toggleClass("active"),a(this).hasClass("active")?a(this).css("transform","rotate(45deg)"):a(this).css("transform","rotate(0deg)")}))}))})(jQuery)})();