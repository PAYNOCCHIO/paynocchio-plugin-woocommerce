(()=>{"use strict";class e{constructor(e){this.options=Object.assign({element:null,effect:"zoom",state:"closed",size:"medium",content:null,footer:null,header:null,title:null},e),null==this.options.element&&(this.options.element=document.createElement("div"),this.options.element.classList.add("modal"),this.options.element.innerHTML='\n                <div class="container">\n                    <div class="header">\n                        <button class="close">&times;</button> \n                    </div>\n                    <div class="content"></div>\n                    <div class="footer">\n                        <button class="close">Close</button>\n                    </div>\n                </div>                        \n            ',document.body.appendChild(this.options.element)),this.options.element.querySelector(".container").classList.remove("zoom","slide"),this.options.element.querySelector(".container").classList.add(this.options.effect),null!=this.options.header&&(this.header=this.options.header),null!=this.options.content&&(this.content=this.options.content),null!=this.options.footer&&(this.footer=this.options.footer),null!=this.options.title&&(this.title=this.options.title),this.size=this.options.size,this._eventHandlers()}open(){this.options.state="open",this.options.element.style.display="flex",this.options.element.getBoundingClientRect(),this.options.element.classList.add("open"),document.body.classList.add("paynocchio-modal-open"),this.options.element.parentNode!==document.body&&document.body.append(this.options.element),this.options.onOpen&&this.options.onOpen(this)}close(){1==document.querySelectorAll(".modal.open").length&&document.body.classList.remove("paynocchio-modal-open"),this.options.state="closed",this.options.element.classList.remove("open"),this.options.element.style.display="none",this.options.onClose&&this.options.onClose(this)}get state(){return this.options.state}get effect(){return this.options.effect}set effect(e){this.options.effect=e,this.options.element.querySelector(".container").classList.remove("zoom","slide"),this.options.element.querySelector(".container").classList.add(e)}get size(){return this.options.size}set size(e){this.options.size=e,this.options.element.classList.remove("small","large","medium","full"),this.options.element.classList.add(e)}get content(){return this.options.element.querySelector(".content").innerHTML}get contentElement(){return this.options.element.querySelector(".content")}set content(e){e?(this.options.element.querySelector(".content")||this.options.element.querySelector(".container").insertAdjacentHTML("afterbegin",'<div class="content"></div>'),this.options.element.querySelector(".content").innerHTML=e):this.options.element.querySelector(".content").remove()}get header(){return this.options.element.querySelector(".header").innerHTML}get headerElement(){return this.options.element.querySelector(".header")}set header(e){e?(this.options.element.querySelector(".header")||this.options.element.querySelector(".container").insertAdjacentHTML("afterbegin",'<div class="header"></div>'),this.options.element.querySelector(".header").innerHTML=e):this.options.element.querySelector(".header").remove()}get title(){return this.options.element.querySelector(".header .title")?this.options.element.querySelector(".header .title").innerHTML:null}set title(e){this.options.element.querySelector(".header .title")||this.options.element.querySelector(".header").insertAdjacentHTML("afterbegin",'<h3 class="title"></h3>'),this.options.element.querySelector(".header .title").innerHTML=e}get footer(){return this.options.element.querySelector(".footer").innerHTML}get footerElement(){return this.options.element.querySelector(".footer")}set footer(e){e?(this.options.element.querySelector(".footer")||this.options.element.querySelector(".container").insertAdjacentHTML("beforeend",'<div class="footer"></div>'),this.options.element.querySelector(".footer").innerHTML=e):this.options.element.querySelector(".footer").remove()}_eventHandlers(){this.options.element.querySelectorAll(".close").forEach((e=>{e.onclick=e=>{e.preventDefault(),this.close()}}))}static initElements(){document.querySelectorAll("[data-modal]").forEach((t=>{t.addEventListener("click",(o=>{o.preventDefault();let n=document.querySelector(t.dataset.modal),a=new e({element:n});for(let e in n.dataset)a[e]&&(a[e]=n.dataset[e]);a.open()}))}))}static confirm(t,o,n){let a=new e({content:t,header:"",footer:'<button class="success">OK</button><button class="cancel alt">Cancel</button>'});a.footerElement.querySelector(".success").onclick=e=>{e.preventDefault(),o&&o(),a.close()},a.footerElement.querySelector(".cancel").onclick=e=>{e.preventDefault(),n&&n(),a.close()},a.open()}static alert(t,o){let n=new e({content:t,header:"",footer:'<button class="success">OK</button>'});n.footerElement.querySelector(".success").onclick=e=>{e.preventDefault(),o&&o(),n.close()},n.open()}static prompt(t,o,n,a){let s=new e({header:"",footer:'<button class="success">OK</button><button class="cancel alt">Cancel</button>'});s.content=t+`<div class="prompt-input"><input type="text" value="${o}" placeholder="Enter your text..."></div>`,s.footerElement.querySelector(".success").onclick=e=>{e.preventDefault(),n&&n(s.contentElement.querySelector(".prompt-input input").value),s.close()},s.footerElement.querySelector(".cancel").onclick=e=>{e.preventDefault(),a&&a(s.contentElement.querySelector(".prompt-input input").value),s.close()},s.open()}}function t(e,t,o,n){const a=document.getElementById("top_up_amount");document.getElementById("topup_message").innerHTML=t>0?'Your balance will be replenished by $<span id="replenishAmount">'+o+'</span>, commission is $<span id="commissionAmount">'+n+'</span>. You will get <span id="bonusesCounter">'+t+"</span> bonuses.":'Your balance will be replenished by $<span id="replenishAmount">'+o+'</span>, commission is $<span id="commissionAmount">'+n+"</span>.",a&&a.setAttribute("data-value",e)}var o;(o=jQuery)(document).ready((function(){o(".top-up-variants > a").click((function(){let e=o(this).get(0).id.replace("variant_","");o("#top_up_amount").val(e),t(e,.1)})),o(".toggle-autodeposit").click((function(){o(this).toggleClass("checked"),o(this).hasClass("checked")?o("input#autodeposit").attr("value","1"):o("input#autodeposit").attr("value","0")})),o(".card-var").click((function(){o(".card-variants").toggleClass("clicked"),o(".clicked .card-var").click((function(){o(".card-var").removeClass("current-card"),o(this).addClass("current-card"),o("#source-card").attr("value",o(this).attr("data-pan"))}))}))})),(o=>{let n,a,s,i,l;o.ajax({async:!1,url:paynocchio_object.ajaxurl,global:!1,type:"GET",data:{action:"paynocchio_ajax_get_env_structure"},success:function(e){i=e.response.wallet_fixed_commission,a=e.response.wallet_percentage_commission/100,s=1-a,l=e.response.structure.bonus_conversion_rate,n=e.response.structure.rewarding_group.rewarding_rules}});const r=(e,t,o)=>{let n,a=0,s=1/0,i=-1/0,l=1;return e&&e.forEach((e=>{e.operation_type===o&&t>=e.min_amount&&t<=e.max_amount&&(a+=e.value,n=e.value_type,l=e.conversion_rate,e.min_amount<s&&(s=e.min_amount),e.max_amount>i&&(i=e.max_amount))})),{totalValue:"percentage"===n?a/l:a,minAmount:s,maxAmount:i,value_type:n,conversion_rate:l}},c=(e=>{const t=[];return e?(e.forEach((e=>{let o=t.find((t=>t.operation_type===e.operation_type&&t.min_amount===e.min_amount&&t.max_amount===e.max_amount));o?o.value+=e.value:t.push({...e})})),t):null})(n),p=(e,t,o)=>{const n=r(t,e,o).totalValue;return"percentage"===r(t,e,o).value_type?Math.floor(e*(n/100)):n},u=e=>{let t=e*parseFloat(s)-parseFloat(i);return t=Math.round(100*t)/100,t},d=e=>{let t=e*parseFloat(a)+parseFloat(i);return t=Math.round(100*t)/100,t};const m=e=>{o("#top_up_amount").val()?(o(e.target).addClass("cfps-disabled"),o(`#${e.target.id} .cfps-spinner`).removeClass("cfps-hidden"),o.ajax({url:paynocchio_object.ajaxurl,type:"POST",data:{action:"paynocchio_ajax_top_up","ajax-top-up-nonce":o("#ajax-top-up-nonce").val(),amount:o("#top_up_amount").val(),redirect_url:window.location.href},success:function(e){200===e.response.status_code?window.location.replace(JSON.parse(e.response.response).schemas.url):o(".topUpModal .message").html("An error occurred. Please reload page and try again!")}}).error((e=>alert(e.response.response))).always((function(){o(`#${e.target.id} .cfps-spinner`).addClass("cfps-hidden"),o(e.target).removeClass("cfps-disabled")}))):o(".topUpModal .message").html("Please enter amount!")},h=(e,t)=>{o(e.target).addClass("cfps-disabled"),o(".paynocchio-profile-actions .cfps-spinner").removeClass("cfps-hidden"),o.ajax({url:paynocchio_object.ajaxurl,type:"POST",data:{action:"paynocchio_ajax_set_status","ajax-status-nonce":o("#ajax-status-nonce").val(),status:t},success:()=>o(window.location.reload())}).error((e=>alert(e))).always((()=>o(".paynocchio-profile-actions .cfps-spinner").addClass("cfps-hidden")))},_=e=>{o(e.target).addClass("cfps-disabled"),o(`#${e.target.id} .cfps-spinner`).removeClass("cfps-hidden");const t=parseFloat(o("#withdraw_amount").val());parseFloat(o("#witdrawForm .paynocchio-balance-value").text())<t?(o(".withdrawModal .message").text("Sorry, can't do ;)"),o(e.target).removeClass("cfps-disabled"),o(`#${e.target.id} .cfps-spinner`).addClass("cfps-hidden")):o.ajax({url:paynocchio_object.ajaxurl,type:"POST",data:{action:"paynocchio_ajax_withdraw","ajax-withdraw-nonce":o("#ajax-withdraw-nonce").val(),amount:parseFloat(o("#withdraw_amount").val())},success:function(e){200===e.response.status_code?(o("#withdraw_amount").val(""),o(".withdrawModal .message").text("Success!"),y(),function(){const e=o("#place_order"),t=o(".payment_box.payment_method_paynocchio").is(":hidden");e&&!t&&o(document.body).trigger("update_checkout")}(),o(".withdrawModal").delay(1e3).fadeOut("fast"),o("body").removeClass("paynocchio-modal-open")):o(".withdrawModal .message").text("An error occurred. Please reload page and try again!")}}).error((e=>console.log(e))).always((function(){o(`#${e.target.id} .cfps-spinner`).addClass("cfps-hidden"),o(e.target).removeClass("cfps-disabled")}))};function y(){o.ajax({url:paynocchio_object.ajaxurl,type:"POST",data:{action:"paynocchio_ajax_check_balance"},success:function(e){!function(e,t){console.log(e,t),o(".paynocchio-balance-value").attr("data-balance",e),o(".paynocchio-bonus-value").attr("data-bonus",t);let n=parseFloat(o(".paynocchio-balance-value").first().text()),a=parseFloat(e),s=parseFloat(o(".paynocchio-bonus-value").first().text()),i=parseFloat(t);function l(e,t,n){let a=o(".paynocchio-"+e+"-value");if(t===n)return;let s=t,i=(n-t)/250,l=0;var r=setInterval((function(){s+=i;let e=parseFloat(s).toFixed(2);a.html(e),l++,250==l&&(clearInterval(r),a.html(n))}),4)}l("balance",n,a),l("bonus",s,i)}(e.response.balance,e.response.bonuses)}}).error((e=>console.log(e)))}o(document).ready((function(){e.initElements();const n=o("#top_up_button"),a=o("#top_up_mini_form_button"),s=o("#withdraw_button"),i=o("#suspend_button"),r=o("#reactivate_button"),f=o("#block_button"),v=o("#delete_button");n.click((e=>m(e))),a.click((e=>(e=>{o(".topup_mini_form .cfps-spinner").removeClass("cfps-hidden"),o(".topup_mini_form .cfps-check").addClass("cfps-hidden"),o(".topup_mini_form .cfps-cross").addClass("cfps-hidden"),o(e.target).addClass("cfps-disabled"),o.ajax({url:paynocchio_object.ajaxurl,type:"POST",data:{action:"paynocchio_ajax_top_up","ajax-top-up-nonce":o("#ajax-top-up-nonce-mini-form").val(),amount:o("#top_up_amount_mini_form").val(),redirect_url:window.location.href},success:function(e){200===e.response.status_code?window.location.replace(JSON.parse(e.response.response).schemas.url):alert(e.response.response)}}).error((function(){o(".topup_mini_form .cfps-cross").removeClass("cfps-hidden")})).always((function(){o(".topup_mini_form .cfps-spinner").addClass("cfps-hidden"),o(e.target).removeClass("cfps-disabled")}))})(e))),s.click((e=>_(e))),i.click((e=>h(e,"SUSPEND"))),r.click((e=>h(e,"ACTIVE"))),f.click((e=>h(e,"BLOCKED"))),v.click((e=>(e=>{o(e.target).addClass("cfps-disabled"),o(`#${e.target.id} .cfps-spinner`).removeClass("cfps-hidden"),o.ajax({url:paynocchio_object.ajaxurl,type:"POST",data:{action:"paynocchio_ajax_delete_wallet","ajax-delete-nonce":o("#ajax-delete-nonce").val()},success:e=>o(window.location.reload())}).error((e=>console.log(e)))})(e))),o("form.checkout").on("change",'input[name="payment_method"]',(function(){o(document.body).trigger("update_checkout")}));let b=0,g=parseFloat(o("#top_up_amount").val()),w=u(g),x=d(g);p(w,c,"payment_operation_add_money")>0&&(b=p(w,c,"payment_operation_add_money")),t(g,b,w,x),o("#top_up_amount").on("keyup change",(e=>{let t=0,n=parseFloat(e.target.value),a=u(n),s=d(n);console.log(s),p(a,c,"payment_operation_add_money")>0&&(t=p(a,c,"payment_operation_add_money"));let i=parseFloat(o("#card_balance_limit").text()),l=parseFloat(o(".paynocchio-balance-value").first().text());parseFloat(e.target.value)+l>i?(o("#topup_message").html("When replenishing the amount $"+n+" the balance limit will exceed the set value $"+i),o("#top_up_button").attr("disabled","true").addClass("disabled")):e.target.value<parseFloat(o("#top_up_amount").attr("min"))?(o("#top_up_button").attr("disabled","true").addClass("disabled"),o("#topup_message").html("Please enter amount more than minimum replenishment amount.")):(o("#top_up_button").removeAttr("disabled").removeClass("disabled"),t>0?o("#topup_message").html('Your balance will be replenished by $<span id="replenishAmount">'+a+'</span>, commission is $<span id="commissionAmount">'+s+'</span>. You will get <span id="bonusesCounter">'+t+"</span> bonuses."):o("#topup_message").html('Your balance will be replenished by $<span id="replenishAmount">'+a+'</span>, commission is $<span id="commissionAmount">'+s+"</span>."))})),o(".top-up-variants > a").click((function(){let e=o(this).get(0).id.replace("variant_","");o("#top_up_amount").val(e);let n=u(e),a=d(e);p(n,c,"payment_operation_add_money")>0&&(b=p(n,c,"payment_operation_add_money")),t(e,b,n,a)})),o(document).on("updated_checkout",(function(){e.initElements();const n=o("#top_up_button"),a=o("#withdraw_button");function s(e,n,a){let s,l,r,u,d=o("#paynocchio_after_discount"),m=o("#paynocchio_discount"),h=o("#paynocchio_payment_bonuses");n*a<e?(s=n,l=n*a):(s=e/a,l=e),r=(s*a*100/e).toFixed(2),u=(e-l).toFixed(2),d.html(u),m.html(r);let _=0;p(u,c,"payment_operation_for_services")>0&&(_=p(u,c,"payment_operation_for_services"),console.log(_),h.html(_.toFixed(0))),t(i,f,b,g),u==e?(o(".paynocchio_before_discount").hide(),o(".paynocchio_discount").hide()):(o(".paynocchio_before_discount").show(),o(".paynocchio_discount").show()),0==u?o(".paynocchio_payment_bonuses").hide():o(".paynocchio_payment_bonuses").show()}n.click((e=>m(e))),a.click((e=>_(e))),y(),function(e,t=window.location.href){e=e.replace(/[\[\]]/g,"\\$&");const o=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return o?o[2]?decodeURIComponent(o[2].replace(/\+/g," ")):"":null}("ans")&&o(".woocommerce-notices-wrapper:first-child").prepend('<div class="woocommerce-message" role="alert">Registration complete. Please check your email, then visit this page again.</div>');const i=o("#bonuses-value"),r=o("#bonuses-input"),h=parseFloat(o(".woocommerce-Price-amount").text().replace("$",""));i.val(r.val()),r.on("change",(function(){i.val(r.val()),s(parseFloat(h),r.val(),parseFloat(l))})),i.on("change",(function(){r.val(i.val()),s(parseFloat(h),i.val(),parseFloat(l))})),o("input[type=range]").on("input",(function(){o(this).trigger("change")}));let f=0,v=parseFloat(o("#top_up_amount").val()),b=u(v),g=d(v);function w(){const e=o("#place_order"),t=o(".payment_box.payment_method_paynocchio").is(":hidden");if(e&&!t){const t=parseFloat(o(".paynocchio-balance-value").first().attr("data-balance")),n=parseFloat(o(".paynocchio-bonus-value").first().attr("data-bonus")),a=parseFloat(o(".woocommerce-Price-amount").text().replace("$","")),s=parseFloat(o("#bonuses-value").val());t+n<a?(e.addClass("cfps-disabled"),e.text("Please TopUp your Wallet")):t+n>=a&&s+t<a?(e.addClass("cfps-disabled"),e.text("Please TopUp your Wallet or use your Bonuses")):(e.removeClass("cfps-disabled"),e.text("Place order"))}}p(b,c,"payment_operation_add_money")>0&&(f=p(b,c,"payment_operation_add_money")),t(v,f,b,g),o(".top-up-variants > a").click((function(){let e=o(this).get(0).id.replace("variant_","");o("#top_up_amount").val(e);let n=u(e),a=d(e);p(n,c,"payment_operation_add_money")>0&&(f=p(n,c,"payment_operation_add_money")),t(e,f,n,a)})),o(".toggle-autodeposit").click((function(){o(this).toggleClass("checked"),o(this).hasClass("checked")?o("input#autodeposit").attr("value","1"):o("input#autodeposit").attr("value","0")})),o(".card-var").click((function(){o(".card-variants").toggleClass("clicked"),o(".clicked .card-var").click((function(){o(".card-var").removeClass("current-card"),o(this).addClass("current-card"),o("#source-card").attr("value",o(this).attr("data-pan"))}))})),w(),o("#bonuses-value").on("change",(function(){w()})),o('input[type="range"].slider-progress').each((function(){o(this).css("--value",o(this).val()),o(this).css("--min",""==o(this).attr("min")?"0":o(this).attr("min")),o(this).css("--max",""==o(this).attr("max")?"0":o(this).attr("max")),o(this).on("input",(function(){o(this).css("--value",o(this).val()),o("#bonuses-value").trigger("change")}))})),o("#top_up_amount").on("keyup change",(e=>{let n=0,a=parseFloat(e.target.value);p(a,c,"payment_operation_add_money")>0&&(n=p(a,c,"payment_operation_add_money"));let s=u(a),i=d(a);t(e.target.value,n,s,i);let l=parseFloat(o("#card_balance_limit").text()),r=parseFloat(o(".paynocchio-balance-value").first().text());parseFloat(e.target.value)+r>l?(o("#topup_message").html("When replenishing the amount $"+a+" the balance limit will exceed the set value $"+l),o("#top_up_button").attr("disabled","true").addClass("disabled")):e.target.value<parseFloat(o("#top_up_amount").attr("min"))?(o("#top_up_button").attr("disabled","true").addClass("disabled"),o("#topup_message").html("Please enter amount more than minimum replenishment amount.")):(o("#top_up_button").removeAttr("disabled").removeClass("disabled"),n>0?o("#topup_message").html('Your balance will be replenished by $<span id="replenishAmount">'+s+'</span>, commission is $<span id="commissionAmount">'+i+'</span>. You will get <span id="bonusesCounter">'+n+"</span> bonuses."):o("#topup_message").html('Your balance will be replenished by $<span id="replenishAmount">'+s+'</span>, commission is $<span id="commissionAmount">'+i+"</span>."))}))})),o("#show_mini_modal").on("click",(function(){o(".topup_mini_form").toggle(),o(this).toggleClass("active"),o(this).hasClass("active")?o(this).css("transform","rotate(45deg)"):o(this).css("transform","rotate(0deg)")}))}))})(jQuery)})();